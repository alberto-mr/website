---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getPublicationsByResearchArea, generateBibTeX, getDisplayYear } from '../utils/publications';

const relatedPublications = getPublicationsByResearchArea('eud', 1000);
---

<BaseLayout title="End User Development" description="Research on empowering users to create, adapt, and debug smart services and IoT behaviors.">
  <section style="padding: 4rem 0; background: white;">
    <div class="container">
      <h1 class="section-title" style="margin-bottom: 1rem;">End User Development</h1>
      <p class="lead" style="color: var(--text-secondary); max-width: 70ch; text-align: center; margin: 0 auto;">
        Empowering people to personalize connected devices and online services without programming expertise. 
        My research spans semantic approaches to IoT personalization, voice-based rule composition, debugging 
        mechanisms for trigger–action programming, and educational tools that make end-user development 
        accessible across diverse technological contexts.
      </p>

      <div class="research-grid" style="margin-top: 2rem;">
        <div class="research-card" data-aos="fade-up">
          <div class="card-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M9 11H5a2 2 0 0 0-2 2v3c0 1.1.9 2 2 2h4m0-7h10a2 2 0 0 1 2 2v3c0 1.1-.9 2-2 2H9m0-7V9a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v2"/>
              <path d="M9 12h6"/>
            </svg>
          </div>
          <h3>High Level Rule Composition</h3>
          <p>Enabling natural language interaction for defining trigger–action rules through conversational interfaces and voice commands.</p>
          
          <div class="examples-section">
            <h4>Examples</h4>
            <div class="card-actions">
              <a href="/assets/video/conversational.mp4" class="btn btn-primary btn-sm" target="_blank">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polygon points="5,3 19,12 5,21"/>
                </svg>
                HeyTAP
              </a>
            </div>
          </div>
        </div>
        <div class="research-card" data-aos="fade-up" data-aos-delay="100">
          <div class="card-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 2L2 7l10 5 10-5-10-5z"/>
              <path d="M2 17l10 5 10-5"/>
              <path d="M2 12l10 5 10-5"/>
              <circle cx="12" cy="12" r="2"/>
            </svg>
          </div>
          <h3>Debugging</h3>
          <p>Creating intuitive debugging tools using metaphors like jigsaw puzzles to help users understand and troubleshoot trigger–action programming issues.</p>
          
          <div class="examples-section">
            <h4>Examples</h4>
            <div class="card-actions">
              <a href="/assets/video/myiotpuzzle.mp4" class="btn btn-primary btn-sm" target="_blank">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polygon points="5,3 19,12 5,21"/>
                </svg>
                My IoT Puzzle
              </a>
              <a href="https://www.youtube.com/watch?v=iE34A1agELI&ab_channel=ACMSIGCHI" class="btn btn-primary btn-sm" target="_blank">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polygon points="5,3 19,12 5,21"/>
                </svg>
                EUDebug
              </a>
            </div>
          </div>
        </div>
        <div class="research-card" data-aos="fade-up" data-aos-delay="200">
          <div class="card-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M9 12l2 2 4-4"/>
              <path d="M21 12c-1 0-3-1-3-3s2-3 3-3 3 1 3 3-2 3-3 3"/>
              <path d="M3 12c1 0 3-1 3-3s-2-3-3-3-3 1-3 3 2 3 3 3"/>
              <path d="M12 3c0 1-1 3-3 3s-3-2-3-3 1-3 3-3 3 2 3 3"/>
              <path d="M12 21c0-1 1-3 3-3s3 2 3 3-1 3-3 3-3-2-3-3"/>
            </svg>
          </div>
          <h3>Recommendations</h3>
          <p>Developing intelligent recommendation systems that help users discover and compose effective trigger–action rules based on their context and preferences.</p>
          
          <div class="examples-section">
            <h4>Examples</h4>
            <div class="card-actions">
              <a href="/assets/video/recrules.mp4" class="btn btn-primary btn-sm" target="_blank">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polygon points="5,3 19,12 5,21"/>
                </svg>
                TAPrec
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>


  <section style="padding: 2rem 0 4rem; background: white;">
    <div class="container">
      <h2 class="section-title" style="margin-bottom: 1rem;">Related Publications</h2>
      <div class="publications-list">
        {relatedPublications.map(pub => {
          const bibtex = generateBibTeX(pub);
          
          return (
            <div class="publication-entry">
              <div class="pub-year-badge">{getDisplayYear(pub)}</div>
              <div class="pub-details">
                <h4><a href={pub.link} target="_blank" rel="noopener">{pub.title}</a></h4>
                <p>{pub.authors}, {pub.venue}</p>
                {pub.doi && (
                  <p style="font-size: 0.9rem; color: var(--text-secondary); margin-top: 0.25rem;">
                    DOI: <a href={`https://doi.org/${pub.doi}`} target="_blank" rel="noopener" style="color: var(--accent-color);">{pub.doi}</a>
                  </p>
                )}
                <div class="pub-actions" style="margin-top: 0.75rem; display: flex; gap: 0.75rem; align-items: center;">
                  <button 
                    class="bibtex-download-btn" 
                    data-bibtex={JSON.stringify(bibtex)}
                    title="Copy BibTeX to clipboard"
                  >
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                      <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                    </svg>
                    Copy BibTeX
                  </button>
                </div>
              </div>
            </div>
          );
        })}
      </div>
      <div class="view-all-pubs" style="margin-top: 2rem;">
        <a href="/publications/" class="btn">View all publications →</a>
      </div>
    </div>
  </section>
</BaseLayout>

<script>
  function copyBibTeXToClipboard(bibtex) {
    navigator.clipboard.writeText(bibtex).then(() => {
      showToast('BibTeX copied to clipboard!');
    }).catch(err => {
      console.error('Failed to copy BibTeX: ', err);
      showToast('Failed to copy BibTeX', 'error');
    });
  }

  function showToast(message, type = 'success') {
    // Remove any existing toast
    const existingToast = document.querySelector('.toast');
    if (existingToast) {
      existingToast.remove();
    }

    // Create toast element
    const toast = document.createElement('div');
    toast.className = `toast toast-${type}`;
    toast.textContent = message;
    
    // Add to page
    document.body.appendChild(toast);
    
    // Force a reflow to ensure the element is rendered
    toast.offsetHeight;
    
    // Show toast with animation
    setTimeout(() => {
      toast.classList.add('toast-show');
    }, 10);
    
    // Hide and remove toast after 3 seconds
    setTimeout(() => {
      toast.classList.remove('toast-show');
      setTimeout(() => {
        if (toast.parentNode) {
          toast.parentNode.removeChild(toast);
        }
      }, 300);
    }, 3000);
  }

  // Add event listeners to all BibTeX copy buttons
  document.addEventListener('DOMContentLoaded', function() {
    const bibtexButtons = document.querySelectorAll('.bibtex-download-btn');
    
    bibtexButtons.forEach(button => {
      button.addEventListener('click', function() {
        const bibtex = this.getAttribute('data-bibtex');
        if (bibtex) {
          copyBibTeXToClipboard(JSON.parse(bibtex));
        }
      });
    });
  });
</script>

<style>
  .research-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
    gap: 2rem;
    margin: 2rem 0;
    align-items: stretch;
  }

  .research-card {
    background: white;
    padding: 2rem;
    border-radius: 12px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    border: 1px solid var(--border-color, #e5e7eb);
    transition: all 0.3s ease;
    text-align: center;
    display: flex;
    flex-direction: column;
    height: 100%;
  }

  .research-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
  }

  .card-icon {
    width: 60px;
    height: 60px;
    background: var(--gradient-primary, linear-gradient(135deg, #667eea 0%, #764ba2 100%));
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 1.5rem;
    color: white;
  }

  .card-icon svg {
    width: 30px;
    height: 30px;
  }

  .research-card h3 {
    font-size: 1.25rem;
    font-weight: 600;
    margin-bottom: 1rem;
    color: var(--text-primary, #1f2937);
  }

  .research-card p {
    color: var(--text-secondary, #6b7280);
    line-height: 1.6;
    margin: 0 0 2rem 0;
    flex-grow: 1;
  }

  .examples-section {
    margin-top: auto;
    padding-top: 1.5rem;
    border-top: 1px solid var(--border-color, #e5e7eb);
  }

  .examples-section h4 {
    font-size: 0.85rem;
    font-weight: 600;
    color: var(--text-primary, #1f2937);
    margin-bottom: 1rem;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    opacity: 0.8;
  }

  .card-actions {
    display: flex;
    gap: 0.75rem;
    flex-wrap: wrap;
    justify-content: center;
  }

  .btn-sm {
    padding: 0.7rem 1.3rem;
    font-size: 0.9rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    border-radius: 8px;
    font-weight: 500;
    text-decoration: none;
    transition: all 0.3s ease;
    min-width: fit-content;
    white-space: nowrap;
  }

  .btn-primary {
    background: var(--gradient-primary, linear-gradient(135deg, #667eea 0%, #764ba2 100%));
    color: white;
    border: none;
  }

  .btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
  }

  .btn-outline {
    background: transparent;
    color: var(--text-primary, #1f2937);
    border: 2px solid var(--accent-color, #667eea);
  }

  .btn-outline:hover {
    background: var(--accent-color, #667eea);
    color: white;
  }

  .btn-sm svg {
    width: 16px;
    height: 16px;
  }


  @media (max-width: 768px) {
    .research-grid {
      grid-template-columns: 1fr;
      gap: 1.5rem;
    }

    .research-card {
      padding: 1.5rem;
    }

    .card-icon {
      width: 50px;
      height: 50px;
    }

    .card-icon svg {
      width: 25px;
      height: 25px;
    }

    .card-actions {
      gap: 0.5rem;
    }
    
    .btn-sm {
      padding: 0.6rem 1rem;
      font-size: 0.85rem;
    }
  }
</style>
